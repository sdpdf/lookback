<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>浪人回顧</title>
    <link rel="stylesheet" href="style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Antique+B1&display=swap" rel="stylesheet">
</head>
<body>
    <div class="box">

     <img id="monthlyImage" alt="Monthly Image" class="month">


     <p class="bottom-left">浪人追憶</p>

    </div>

    <script>
        // 現在の月を取得（1月 = 0、2月 = 1 ... 12月 = 11）
        var currentDate = new Date();
        var currentMonth = currentDate.getMonth(); // 0から始まるので注意

        // 月ごとのファイル名を配列に格納
        var monthImages = [
            "https://sdpdf.github.io/archive/Jan.png", "https://sdpdf.github.io/archive/Feb.png", "https://sdpdf.github.io/archive/Mar.png", "https://sdpdf.github.io/archive/Apr.png", "https://sdpdf.github.io/archive/May.png", "https://sdpdf.github.io/archive/Jun.png", 
            "https://sdpdf.github.io/archive/Jul.png", "https://sdpdf.github.io/archive/Aug.png", "https://sdpdf.github.io/archive/Sep.png", "https://sdpdf.github.io/archive/Oct.png", "https://sdpdf.github.io/archive/Nov.png", "https://sdpdf.github.io/archive/Dec.png"
        ];

        // 現在の月に対応する画像ファイルを設定
        var imageFile = monthImages[currentMonth];

        // imgタグのsrc属性に画像ファイルをセット
        document.getElementById("monthlyImage").src = imageFile;
    </script>

<script>
    // 共通の関数と定数
    function getDayOfWeek(date) {
        const weekdayNames = ["日曜日", "月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日"];
        return weekdayNames[date.getDay()];
    }

    function getTodayDateInfo() {
        const todayDate = new Date();
        const currentMonth = todayDate.getMonth() + 1;
        const currentDay = todayDate.getDate();
        let currentYear = 2022;
        
        // 1月、2月、3月は2023年として処理する
        if (currentMonth === 1 || currentMonth === 2 || currentMonth === 3) {
            currentYear = 2023;
        }

        // 正しい年で日付オブジェクトを作成
        const adjustedDate = new Date(currentYear, currentMonth - 1, currentDay);

        return { adjustedDate, currentMonth, currentDay };
    }

    function fetchCSV(file) {
        return fetch(file)
            .then(response => response.text())
            .then(text => text.split('\n').map(row => row.split(',')));
    }

    function determineTerm(currentMonth) {
        return currentMonth >= 4 && currentMonth <= 8 ? 'zenki.csv' : 'kouki.csv';
    }

    // 日付をフォーマットして表示する関数
    function displayFormattedDate() {
        const { adjustedDate, currentMonth, currentDay } = getTodayDateInfo();
        const dayOfWeek = getDayOfWeek(adjustedDate);
        const formattedDate = `${currentMonth}月${currentDay}日（${dayOfWeek}）`;

        document.getElementById('date').textContent = formattedDate;
    }

    // 時間割を表示する関数
    async function displayTimetable() {
        const { adjustedDate, currentMonth } = getTodayDateInfo();
        const currentDayOfWeek = getDayOfWeek(adjustedDate).replace("曜日", ""); // 曜日を日本語の形式に合わせる
        const termFileName = determineTerm(currentMonth);
        const timetableData = await fetchCSV(termFileName);
        const weekdayNames = ["日", "月", "火", "水", "木", "金", "土"];
        const dayOfWeekIndex = weekdayNames.indexOf(currentDayOfWeek);

        if (dayOfWeekIndex === -1) {
            document.getElementById('timetable').querySelector('tbody').innerHTML = '<tr><td colspan="9">時間割が見つかりませんでした。</td></tr>';
            return;
        }

        const subjectsForToday = timetableData[dayOfWeekIndex] || [];
        const tableRowHTML = subjectsForToday.slice(0, 9).map(subject => `<td>${subject || ''}</td>`).join('');

        document.getElementById('timetable').querySelector('tbody').innerHTML = `<tr>${tableRowHTML}</tr>`;
    }

    // DOMが読み込まれた後に実行する関数
    document.addEventListener('DOMContentLoaded', () => {
        displayFormattedDate();
        displayTimetable();
    });
</script>

    <div class="body">
    <p id="date" class="date">読み込み中...</p>
    
    
    <div class="space1">この日の時間割</div>
    <table id="timetable">
        <thead>
            <tr>
                <th></th>
                <th>1</th>
                <th>2</th>
                <th>3</th>
                <th>4</th>
                <th>5</th>
                <th>6</th>
                <th>7</th>
                <th>8</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="9">読み込み中...</td>
            </tr>
        </tbody>
    </table>

    

    <script>
        async function fetchEvent(date) {
            const response = await fetch('tw.csv');
            const text = await response.text();
            const rows = text.split('\n');
            const events = rows.slice(1).map(row => row.split(','));
            for (let [csvDate, event] of events) {
                if (csvDate === date) {
                    return event;
                }
            }
            return 'イベントが見つかりませんでした。';
        }
        async function displayTodayEvent() {
            const today = new Date();
            const month = today.getMonth() + 1; // 月は0から始まるので+1
            const day = today.getDate();
            const date = `${month}/${day}`;
            const event = await fetchEvent(date);
            document.getElementById('result').innerHTML = `${event}`;
        }
        document.addEventListener('DOMContentLoaded', displayTodayEvent);
    </script>

<div class="space2">この日のツイート</div>

    <p id="result">読み込み中...</p>
</div>
</body>
</html>
